<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ÎßêÎ°±Ïù¥ Ïö∞Ïú†Í≤åÏûÑ ‚ú®</title>
  <style>
    body {
      font-family: sans-serif;
      background: #f0f9ff;
      text-align: center;
      margin: 0;
      padding: 20px;
    }

    #game-container {
      display: flex;
      justify-content: center;
      gap: 40px;
      position: relative;
    }

    #grid {
      touch-action: none !important;
      -webkit-user-select: none;
      -webkit-touch-callout: none;
      display: grid;
      grid-template-columns: repeat(10, 52px);
      grid-template-rows: repeat(17, 52px);
      gap: 5px;
      user-select: none;
    }

    .cell {
      position: relative;
      width: 52px;
      height: 52px;
    }

    .milk {
      width: 100%;
      height: 100%;
    }

    .num-circle {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 28px;
      height: 28px;
      background: rgba(255, 255, 255, 0.8);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 16px;
      color: #000;
      z-index: 2;
    }

    .selected {
      outline: 3px solid #4dabf7;
    }

    #baby {
      width: 120px;
      height: 120px;
      background-image: url('baby_default.png');
      background-size: cover;
      margin-top: 40px;
    }

    #score, #timer {
      font-size: 20px;
      margin: 10px;
    }
  </style>
</head>
<body>
  <div style="display: flex; align-items: center; justify-content: center; gap: 20px; margin-bottom: 10px;">
    <div>
      <h1>ü•õ ÎßêÎ°±Ïù¥ Ïö∞Ïú†Í≤åÏûÑ v.6 ü•õ</h1>
      <div id="score">Ï†êÏàò: 0</div>
      <div id="timer">ÎÇ®ÏùÄ ÏãúÍ∞Ñ: 120Ï¥à</div>
    </div>
    <div id="baby"></div>
  </div>

  <div id="game-container">
    <button id="exit-button" style="position: absolute; top: -20px; right: -20px; z-index: 10; font-size: 24px; border: none; background: transparent; cursor: pointer;">‚ùå</button>
    <div id="grid"></div>
  </div>

  <script>
const grid = document.getElementById('grid');
const baby = document.getElementById('baby');
const scoreEl = document.getElementById('score');
const timerEl = document.getElementById('timer');
let cells = [];
let isDragging = false;
let startCell = null;
let currentEndCell = null;
let score = 0;
let timeLeft = 60;

function createGrid() {
  for (let i = 0; i < 170; i++) {
    const cell = document.createElement('div');
    cell.classList.add('cell');

    const value = Math.floor(Math.random() * 9) + 1;
    cell.dataset.value = value;
    cell.dataset.index = i;

    const img = document.createElement('img');
    img.src = 'milk.png';
    img.className = 'milk';

    const circle = document.createElement('div');
    circle.className = 'num-circle';
    circle.innerHTML = `<span>${value}</span>`;

    cell.appendChild(img);
    cell.appendChild(circle);

    grid.appendChild(cell);
    cells.push(cell);
  }
}

function getRowCol(index) {
  return { row: Math.floor(index / 10), col: index % 10 };
}

function selectBox(start, end) {
  const startRC = getRowCol(start);
  const endRC = getRowCol(end);
  const minRow = Math.min(startRC.row, endRC.row);
  const maxRow = Math.max(startRC.row, endRC.row);
  const minCol = Math.min(startRC.col, endRC.col);
  const maxCol = Math.max(startRC.col, endRC.col);
  let selected = [];
  for (let r = minRow; r <= maxRow; r++) {
    for (let c = minCol; c <= maxCol; c++) {
      const idx = r * 10 + c;
      selected.push(cells[idx]);
    }
  }
  return selected;
}

function clearSelection() {
  cells.forEach(cell => cell.classList.remove('selected'));
}

function showSmile() {
  baby.style.backgroundImage = "url('baby_smile.png')";
  setTimeout(() => {
    baby.style.backgroundImage = "url('baby_default.png')";
  }, 1000);
}

function startTimer() {
  const interval = setInterval(() => {
    timeLeft--;
    timerEl.textContent = `ÎÇ®ÏùÄ ÏãúÍ∞Ñ: ${timeLeft}Ï¥à`;
    if (timeLeft <= 0) {
      clearInterval(interval);
      alert(`Í≤åÏûÑ Ï¢ÖÎ£å! ÎãπÏã†Ïùò Ï†êÏàòÎäî ${score}Ï†êÏûÖÎãàÎã§.`);
    }
  }, 1000);
}

function getTouchCell(e) {
  const touch = e.touches[0] || e.changedTouches[0];
  const el = document.elementFromPoint(touch.clientX, touch.clientY);
  return el ? el.closest('.cell') : null;
}

grid.addEventListener('touchstart', (e) => {
  e.preventDefault();
  const target = getTouchCell(e);
  if (!target) return;
  isDragging = true;
  startCell = parseInt(target.dataset.index);
  currentEndCell = startCell;
  clearSelection();
});

grid.addEventListener('touchmove', (e) => {
  e.preventDefault();
  if (!isDragging) return;
  const target = getTouchCell(e);
  if (!target) return;
  currentEndCell = parseInt(target.dataset.index);
  clearSelection();
  const selected = selectBox(startCell, currentEndCell);
  selected.forEach(cell => cell.classList.add('selected'));
});

grid.addEventListener('touchend', (e) => {
  e.preventDefault();
  if (!isDragging) return;
  const selected = selectBox(startCell, currentEndCell);
  const sum = selected.reduce((acc, cell) => acc + parseInt(cell.dataset.value), 0);
  if (sum === 10) {
    showSmile();
    score += selected.length;
    scoreEl.textContent = `Ï†êÏàò: ${score}`;
    selected.forEach(cell => {
      cell.dataset.value = 0;
      cell.innerHTML = '';
    });
  }
  clearSelection();
  isDragging = false;
  startCell = null;
  currentEndCell = null;
});

createGrid();
startTimer();

document.getElementById('exit-button').addEventListener('click', () => {
  location.reload();
});

  </script>
</body>
</html>
